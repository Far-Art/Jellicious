<section>
    <h2 mat-dialog-title>סל קניות</h2>
    <mat-dialog-content>
        @if (dataSource.data.length > 0) {
            <table mat-table [dataSource]="dataSource">
                <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef style="width: 4rem">
                        <mat-checkbox (click)="$event.stopPropagation()"
                                      (change)="toggleAllRows()"
                                      [checked]="isAllSelected()"
                                      [indeterminate]="selectedIds.size > 0 && !isAllSelected()"
                                      [aria-label]="checkboxLabel()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let element">
                        <mat-checkbox (click)="$event.stopPropagation()"
                                      (change)="toggle(element.product.id)"
                                      [checked]="selectedIds.has(element.product.id)"
                                      [aria-label]="checkboxLabel(element)">
                        </mat-checkbox>
                    </td>
                    <td mat-footer-cell *matFooterCellDef>סה"כ</td>
                </ng-container>

                <ng-container matColumnDef="img_name">
                    <th mat-header-cell *matHeaderCellDef style="width: 4rem"></th>
                    <td mat-cell *matCellDef="let element">
                        <div class="product-container">
                            <img width="60" height="60" [ngSrc]="element.product.imageUrl" alt="תמונה של מוצר">
                            <span>{{ element.product.name }}</span>
                        </div>
                    </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>

                <ng-container matColumnDef="amount">
                    <th style="text-align: center" mat-header-cell *matHeaderCellDef>כמות</th>
                    <td mat-cell *matCellDef="let element" style="justify-items: center">
                        <div class="amount-container">
                            <button mat-icon-button (click)="increaseAmount(element)" aria-label="הוסף כמות">
                                <mat-icon class="material-symbols-outlined">add_circle</mat-icon>
                            </button>
                            <span>{{ element.amount }}</span>
                            <button mat-icon-button (click)="decreaseAmount(element)" aria-label="הפחת כמות">
                                <mat-icon class="material-symbols-outlined">do_not_disturb_on</mat-icon>
                            </button>
                        </div>
                    </td>
                    <td style="text-align: center" mat-footer-cell *matFooterCellDef>{{ getTotalAmount() }}</td>
                </ng-container>

                <ng-container matColumnDef="price">
                    <th style="width: 7rem" mat-header-cell *matHeaderCellDef>מחיר</th>
                    <td mat-cell *matCellDef="let element" [attr.aria-label]="(element.product.newPrice ?? element.product.price) + ' שקלים'">
                        {{ (element.product.newPrice ?? element.product.price) }}
                    </td>
                    <td mat-footer-cell *matFooterCellDef>{{ getTotalCost() | currency: 'ILS' }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let el; columns: displayedColumns;" [class.active]="isActiveClass(el.product.id)"></tr>
                <tr class="footer-row" mat-footer-row *matFooterRowDef="displayedColumns"></tr>
            </table>
        } @else {
            <p>אין מוצרים בסל</p>
        }
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button mat-button mat-dialog-close>סגור</button>
        <button [disabled]="selectedIds.size === 0" mat-mini-fab (click)="purchase()">בצע הזמנה</button>
    </mat-dialog-actions>
</section>
